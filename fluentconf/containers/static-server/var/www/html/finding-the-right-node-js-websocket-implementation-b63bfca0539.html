<!DOCTYPE html><html xmlns:cc="http://creativecommons.org/ns#"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Finding the right Node.js WebSocket implementation   — Medium</title><link rel="canonical" href="https://medium.com/@denizozger/finding-the-right-node-js-websocket-implementation-b63bfca0539"><meta name="title" content="Finding the right Node.js WebSocket implementation  "><meta name="referrer" content="always"><meta name="description" content="A journey with ws, Socket.IO, Engine.IO,  and Primus"><meta property="og:site_name" content="Medium"><meta property="og:title" content="Finding the right Node.js WebSocket implementation  "><meta property="og:url" content="https://medium.com/@denizozger/finding-the-right-node-js-websocket-implementation-b63bfca0539"><meta property="og:image" content="https://cdn-images-1.medium.com/max/800/desat/multiply/grey/overlay/grey/1*RrKQrpOqLNPh6NJQ_InjXg.jpeg"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="A journey with ws, Socket.IO, Engine.IO,  and Primus"><meta name="twitter:site" content="@Medium"><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/800/desat/multiply/grey/overlay/grey/1*RrKQrpOqLNPh6NJQ_InjXg.jpeg"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@denizozger"><meta name="author" content="Deniz Ozger"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="https://medium.com/@denizozger"><meta property="fb:smart_publish:robots" content="noauto"><meta property="article:published_time" content="2014-01-09T12:01:36.120Z"><meta name="twitter:creator" content="@denizozger"><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium:/p/b63bfca0539"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium:/p/b63bfca0539"><meta property="al:android:url" content="medium://p/b63bfca0539"><meta property="al:web:url" content="https://medium.com/@denizozger/finding-the-right-node-js-websocket-implementation-b63bfca0539"><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/b63bfca0539" /><meta name="theme-color" content="#000000"><link rel="stylesheet" href="https://cdn-static-1.medium.com/_/fp/css/main-base.VzyPz4jos5FyyiYfuOx6fQ.css"><!--.--><!--.--><!--[if lt IE 9]><!--.--><![endif]--><link rel="shortcut icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-new.TAS6uQ-Y7kcKgi0xjcYHXw.ico"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-ipad-retina.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-iphone-retina.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-ipad.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"></head><body itemscope itemtype="http://schema.org/Article" class=" template-flex-article is-noJs"><!--.--><div class="site-main" id="container"><div class="butterBar butterBar--error"></div><div class="surface"><div id="prerendered" class="screenContent"><canvas class="canvas-renderer"></canvas><nav class="metabar u-clearfix js-metabar metabar--top metabar--postArticle"><div class="metabar-block metabar-left u-floatLeft"><a href="https://medium.com/" class="siteNav-logo" data-log-event="home"><svg viewBox="0 0 45 45" width="45" height="45" class="svgIcon svgIcon--logoNew svgIcon-size--45px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-logoNew-45px-p0"></use><use class="svgIcon-use svgIcon-use--part1" xlink:href="#svg-logoNew-45px-p1"></use><use class="svgIcon-use svgIcon-use--part2" xlink:href="#svg-logoNew-45px-p2"></use><use class="svgIcon-use svgIcon-use--part3" xlink:href="#svg-logoNew-45px-p3"></use></svg><span class="u-textScreenReader">Homepage</span></a></div><div class="metabar-block metabar-right u-floatRight"><div class="buttonSet"></div><div class="inputGroup u-xs-hide metabar-predictiveSearch"><button class="button button--chromeless button--inline button--withIcon is-inSiteNavBar button--withSvgIcon"  title="Click to start typing a search term" aria-label="Click to start typing a search term" data-action="focus-search-input"><svg viewBox="0 0 25 25" width="25" height="25" class="svgIcon svgIcon--search svgIcon-size--25px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-search-25px-p0"></use></svg></button><input class="js-predictiveSearchInput textInput textInput--rounded textInput--dark" type="search" placeholder="Search Medium"></div><div class="buttonSet"><button class="button button--circle button--withChrome button--withIcon is-inSiteNavBar u-showOnMobile button--withSvgIcon"  title="Search" aria-label="Search" data-action="open-search"><svg viewBox="0 0 25 25" width="25" height="25" class="svgIcon svgIcon--search svgIcon-size--25px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-search-25px-p0"></use></svg></button><a class="button button--primary button--withChrome"  href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%3A443%2F%40denizozger%2Ffinding-the-right-node-js-websocket-implementation-b63bfca0539"data-action="sign-in-prompt"data-redirect="https://medium.com:443/@denizozger/finding-the-right-node-js-websocket-implementation-b63bfca0539" data-action-source="nav_signup">Sign in / Sign up</a></div></div></nav><div class="postActionsBar js-postActionsBar"><div class="postActionsBar-container container u-size740"><div class="postActionsBar-content row js-postActionsBarContent"><div class="postActions col u-xs-size12of12"><div class="u-floatLeft buttonSet buttonSet--withLabels"><div class="buttonSet-inner"><div class="js-actionRecommend" data-post-id="b63bfca0539" data-size="29px"><button class="button button--primary button--large button--chromeless button--withIcon button--withSvgIcon"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it"data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/b63bfca0539"><span class="button-defaultState"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--heart svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-heart-29px-p0"></use></svg></span><span class="button-activeState"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--heartFilled svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-heartFilled-29px-p0"></use></svg></span></button><button class="button button--chromeless"  data-action="show-recommends" data-action-value="b63bfca0539">166</button></div></div><div class="buttonSet-inner"><button class="button button--large button--dark button--chromeless button--withIcon button--withSvgIcon"  data-action="scroll-to-responses"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--response svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-response-29px-p0"></use></svg></button><button class="button button--chromeless"  data-action="scroll-to-responses">4</button></div></div><div class="u-floatRight buttonSet"><div class="buttonSet-inner"><button class="button button--large button--dark button--chromeless button--withIcon button--withSvgIcon"  data-action="share-on-twitter"value="b63bfca0539"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--twitter svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-twitter-29px-p0"></use></svg></button></div><div class="buttonSet-inner"><button class="button button--large button--dark button--chromeless button--withIcon button--withSvgIcon"  data-action="share-on-facebook"value="b63bfca0539"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--facebook svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-facebook-29px-p0"></use></svg></button></div><div class="buttonSet-separator"></div><div class="buttonSet-inner"><a class="link avatar avatar--inline"  href="https://medium.com/@denizozger" data-action="show-user-card" data-action-type="hover" data-user-id="c1855caedf" dir="auto"><img src="https://cdn-images-1.medium.com/fit/c/24/24/0*sd4q2ml2nYkrQGgb.jpeg" class="avatar-image avatar-image--micro" alt="Go to the profile of Deniz Ozger"><span class="avatar-text">Deniz Ozger</span></a><span class="u-xs-hide"><span class="middotDivider"></span><span class="followState js-followState" data-user-id="c1855caedf"><button class="button button--chromeless u-noUserSelect button--withHover button--unblock js-unblockButton" data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="post_actions_bar"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--chromeless u-noUserSelect button--follow js-followButton"  title="Follow to get new stories and recommendations from this author" aria-label="Follow to get new stories and recommendations from this author"data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/c1855caedf/b63bfca0539" data-action-source="post_actions_bar_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></span></div></div></div></div></div></div><article class="u-sizeViewHeightMin100 postArticle postArticle--full" lang="en"><header class="container is-underMetabar u-size740"><div class="postMetaHeader row u-xs-top10 u-xs-bottom10"><div class="col u-xs-size5of12"><div class="u-floatLeft"><div class="postMetaInline-avatar"><a class="link avatar"  href="https://medium.com/@denizozger" data-action="show-user-card" data-action-type="hover" data-user-id="c1855caedf" dir="auto"><img src="https://cdn-images-1.medium.com/fit/c/36/36/0*sd4q2ml2nYkrQGgb.jpeg" class="avatar-image u-xs-size32x32 u-sm-size36x36" alt="Go to the profile of Deniz Ozger"></a></div><div class="postMetaInline-feedSummary"><a class="link link link--darken link--accent"  href="https://medium.com/@denizozger" data-action="show-user-card" data-action-type="hover" data-user-id="c1855caedf" dir="auto">Deniz Ozger</a><span class="postMetaInline postMetaInline--supplemental">Jan 9, 2014<span class="middotDivider"></span><span class="readingTime">10 min read</span></span></div></div></div><div class="col u-xs-size7of12"><div class="u-floatRight"><div class="postMetaHeader-socialProof"></div></div></div></div></header><main role="main" class="postArticle-content js-postField js-notesSource"><section class=" section--body section--bottomCenter section-image--coverFade is-imageBackgrounded is-backgrounded is-darkBackgrounded section--first"><div class="section-background"contenteditable="false" data-image-id="1*RrKQrpOqLNPh6NJQ_InjXg.jpeg" data-width="4002" data-height="2562" data-filter="grey"><div class="section-backgroundImage"style="background-image: url(https://cdn-images-1.medium.com/fit/t/1200/960/desat/multiply/grey/overlay/grey/gradv/29/81/55/1*RrKQrpOqLNPh6NJQ_InjXg.jpeg);"></div><br></div><div class="section-coverFadePadding u-ignoreBlock"><div class="section-content" data-scroll="cover-fade"><div class="section-inner layoutSingleColumn"><h2 name="title" id="title" class="graf--h2 graf--first">Finding the right Node.js WebSocket implementation  </h2><h4 name="subtitle" id="subtitle" class="graf--h4 graf-after--h2 graf--last">A journey with ws, Socket.IO, Engine.IO,  and Primus</h4></div></div></div><div class="section-captionContent u-ignoreBlock"></div></section><section name="dea3" class=" section--body"><div class="section-divider layoutSingleColumn"><hr class="section-divider"></div><div class="section-content"><div class="section-inner layoutSingleColumn"><p name="5d4c" id="5d4c" class="graf--p graf--first">For a current project at <a href="http://www.whoscored.com/" data-href="http://www.whoscored.com/" class="markup--anchor markup--p-anchor" rel="nofollow">WhoScored</a>, I needed to learn JavaScript, Node.js and WebSocket channel, after seven years of writing web applications with Java and Spring framework. We wanted an application that can send data to thousands of concurrent users, and <a href="http://www.toptal.com/nodejs/why-the-hell-would-i-use-node-js" data-href="http://www.toptal.com/nodejs/why-the-hell-would-i-use-node-js" class="markup--anchor markup--p-anchor" rel="nofollow">Node.js appeared to be the right way of doing it</a> with its event-driven, non-blocking I/O model that can scale up easily.</p><p name="f87d" id="f87d" class="graf--p graf-after--p">Firstly, to learn JavaScript I started doing the tutorials in <a href="http://www.codecademy.com/" data-href="http://www.codecademy.com/" class="markup--anchor markup--p-anchor" rel="nofollow">Code Academy</a> and reading D. Crockford’s <a href="http://shop.oreilly.com/product/9780596517748.do" data-href="http://shop.oreilly.com/product/9780596517748.do" class="markup--anchor markup--p-anchor" rel="nofollow">JavaScript: The Good Parts</a> book. In parallel, I read J. R. Wilson’s <a href="http://pragprog.com/book/jwnode/node-js-the-right-way" data-href="http://pragprog.com/book/jwnode/node-js-the-right-way" class="markup--anchor markup--p-anchor" rel="nofollow">Node.js the Right Way</a> as well. It was a great read: by using some great modules like async, Q, ZMQ, Express, and methods like Promises and Generators, the book explains how to build scalable Node applications. It also covers sockets with Pub/Sub, Req/Res and Push/Pull patterns which shaped the WebSocket applications that I wrote.</p><h3 name="203f" id="203f" class="graf--h3 graf-after--p">System structure</h3><p name="9add" id="9add" class="graf--p graf-after--h3">After some trials, errors, and brainstorming sessions, the final structure looks like this:</p><figure name="83a2" id="83a2" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 440px;"><div class="aspect-ratio-fill" style="padding-bottom: 62.9%;"></div><img class="graf-image" data-image-id="1*NF1K_nSf9f18SMvJWzKsDQ.png" data-width="782" data-height="492" data-action="zoom" data-action-value="1*NF1K_nSf9f18SMvJWzKsDQ.png" src="https://cdn-images-1.medium.com/max/800/1*NF1K_nSf9f18SMvJWzKsDQ.png"></div></figure><p name="b4b0" id="b4b0" class="graf--p graf-after--figure">A client connects for a specific key/resource, let’s say “matchesfeed/8/matchcentre”. WebSocket server’s responsibility is to return some JSON data for this key. If it doesn’t have data for this key in its memory, it requests it from “Fetcher” via a Push socket implemented with <a href="https://npmjs.org/package/zmq" data-href="https://npmjs.org/package/zmq" class="markup--anchor markup--p-anchor" rel="nofollow">ZMQ library</a> over a TCP connection. Fetcher receives this request, and adds it to a queue of jobs. Worker processes (implemented with <a href="http://nodejs.org/api/cluster.html#cluster_cluster_fork_env" data-href="http://nodejs.org/api/cluster.html#cluster_cluster_fork_env" class="markup--anchor markup--p-anchor" rel="nofollow">Node.js clusters</a>) check this queue constantly, get a job, and make an HTTP call to an API that has the actual JSON data for this key. When response is received by a worker, it passes the data to master process, which sends it to WebSocket server, and puts the job back into queue. When WebSocket server receives data, it publishes to clients who are connected for that key. All applications are open source, and you can find web socket server <a href="https://github.com/denizozger/node-websocket" data-href="https://github.com/denizozger/node-websocket" class="markup--anchor markup--p-anchor" rel="nofollow">here</a>, fetcher <a href="https://github.com/denizozger/node-fetcher" data-href="https://github.com/denizozger/node-fetcher" class="markup--anchor markup--p-anchor" rel="nofollow">here</a> and the data provider <a href="https://github.com/denizozger/node-dataprovider" data-href="https://github.com/denizozger/node-dataprovider" class="markup--anchor markup--p-anchor" rel="nofollow">here</a>. Node.js version used in all applications are 0.10.</p><h3 name="2012" id="2012" class="graf--h3 graf-after--p">einaros / ws (v 0.4)</h3><p name="ed06" id="ed06" class="graf--p graf-after--h3">Based on <a href="https://github.com/heroku-examples/node-ws-test" data-href="https://github.com/heroku-examples/node-ws-test" class="markup--anchor markup--p-anchor" rel="nofollow">Heroku’s WebSocket demo</a>, I began with <a href="https://github.com/einaros/ws" data-href="https://github.com/einaros/ws" class="markup--anchor markup--p-anchor" rel="nofollow">einaros/ws</a> implementation. It didn’t have as much as documentation that other frameworks had, but the development went smooth and I had something working in a short time.</p><figure name="be6c" id="be6c" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 104px;"><div class="aspect-ratio-fill" style="padding-bottom: 14.899999999999999%;"></div><img class="graf-image" data-image-id="1*dzS6cW-11XxS3sKwi5TH8A.png" data-width="765" data-height="114" data-action="zoom" data-action-value="1*dzS6cW-11XxS3sKwi5TH8A.png" src="https://cdn-images-1.medium.com/max/800/1*dzS6cW-11XxS3sKwi5TH8A.png"></div><figcaption class="imageCaption">Client beautifully connects via WebSockets</figcaption></figure><p name="e477" id="e477" class="graf--p graf-after--figure">Then I wrote <a href="https://github.com/denizozger/node-websocket/blob/master/loadtest.js" data-href="https://github.com/denizozger/node-websocket/blob/master/loadtest.js" class="markup--anchor markup--p-anchor" rel="nofollow">a load tes</a>t to see the performance. The test basically connects clients every half a second, all requesting the same data. Data is <strong class="markup--strong markup--p-strong">165KB</strong>, and is sent <strong class="markup--strong markup--p-strong">every second.</strong> With <strong class="markup--strong markup--p-strong">120 concurrent clients</strong>, the application allocates around 210MB of RAM, and data sent appears to be around 35 MB/second. The test machine is a 3.4 Ghz Intel i7 (8 processors) with 16GB of RAM, running OSX v10.9.</p><figure name="40cf" id="40cf" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 366px; max-height: 106px;"><div class="aspect-ratio-fill" style="padding-bottom: 28.999999999999996%;"></div><img class="graf-image" data-image-id="1*ho2lGmulhn-ElpN-km49vw.png" data-width="366" data-height="106" src="https://cdn-images-1.medium.com/max/800/1*ho2lGmulhn-ElpN-km49vw.png"></div></figure><p name="9088" id="9088" class="graf--p graf-after--figure">I monitored the process with <a href="https://npmjs.org/package/strong-agent" data-href="https://npmjs.org/package/strong-agent" class="markup--anchor markup--p-anchor" rel="nofollow">Strongloop’s agent</a>, I find it pretty impressive.</p><figure name="da66" id="da66" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 832px;"><div class="aspect-ratio-fill" style="padding-bottom: 118.9%;"></div><img class="graf-image" data-image-id="1*LoD0vHyf--qeo_6_yT73tw.png" data-width="885" data-height="1052" data-action="zoom" data-action-value="1*LoD0vHyf--qeo_6_yT73tw.png" src="https://cdn-images-1.medium.com/max/800/1*LoD0vHyf--qeo_6_yT73tw.png"></div></figure><p name="0960" id="0960" class="graf--p graf-after--figure">At this point, the biggest drawback for me was it being a pure WebSocket implementation: if the client browser did not support WebSockets, it would not work. This made me try <a href="http://socket.io/" data-href="http://socket.io/" class="markup--anchor markup--p-anchor" rel="nofollow">Socket.IO</a>.</p><h3 name="6bf6" id="6bf6" class="graf--h3 graf-after--p">Socket.IO (v. 0.9)</h3><p name="91e4" id="91e4" class="graf--p graf-after--h3">Socket.IO seemed like the perfect solution, as it selects the most capable transport at runtime: it tries to connect to server via WebSockets first, if it doesn’t work, it <strong class="markup--strong markup--p-strong">downgrades</strong> by trying XHR-polling, if it doesn’t work, continues with flash sockets etc. Moreover, it would try to <strong class="markup--strong markup--p-strong">reconnect</strong> sockets if connection fails, and it supports <strong class="markup--strong markup--p-strong">rooms</strong> so that I could cluster connections based on what information they asked for, without any custom implementation. So I re-implemented the application by keeping everything the same but web socket framework.</p><figure name="13ee" id="13ee" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 548px; max-height: 198px;"><div class="aspect-ratio-fill" style="padding-bottom: 36.1%;"></div><img class="graf-image" data-image-id="1*Tj6lWTMf_dWl993x9eGZhw.png" data-width="548" data-height="198" src="https://cdn-images-1.medium.com/max/800/1*Tj6lWTMf_dWl993x9eGZhw.png"></div><figcaption class="imageCaption">Client connects to Socket.IO server</figcaption></figure><p name="6ba6" id="6ba6" class="graf--p graf-after--figure">Indeed, when the server is down, Socket.IO tries to connect back with decreasing frequency.</p><figure name="cd28" id="cd28" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 554px; max-height: 246px;"><div class="aspect-ratio-fill" style="padding-bottom: 44.4%;"></div><img class="graf-image" data-image-id="1*XKFMQnM3r07Zt4sia2OsWg.png" data-width="554" data-height="246" src="https://cdn-images-1.medium.com/max/800/1*XKFMQnM3r07Zt4sia2OsWg.png"></div></figure><p name="7e24" id="7e24" class="graf--p graf-after--figure">And when the server is up, WebSocket connection is re-established:</p><figure name="a8ac" id="a8ac" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 550px; max-height: 130px;"><div class="aspect-ratio-fill" style="padding-bottom: 23.599999999999998%;"></div><img class="graf-image" data-image-id="1*1cDuBI9hO8rWvPphpwTWEA.png" data-width="550" data-height="130" src="https://cdn-images-1.medium.com/max/800/1*1cDuBI9hO8rWvPphpwTWEA.png"></div></figure><p name="040e" id="040e" class="graf--p graf-after--figure">Load test results are below, it is the same test I executed for ws/einaros implementation with the same data:</p><figure name="b812" id="b812" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 826px;"><div class="aspect-ratio-fill" style="padding-bottom: 118%;"></div><img class="graf-image" data-image-id="1*WAVyS8_ODWQL0r9uYG0UJw.png" data-width="894" data-height="1055" data-action="zoom" data-action-value="1*WAVyS8_ODWQL0r9uYG0UJw.png" src="https://cdn-images-1.medium.com/max/800/1*WAVyS8_ODWQL0r9uYG0UJw.png"></div></figure><p name="ca1c" id="ca1c" class="graf--p graf-after--figure">The data output looks like:</p><figure name="6e90" id="6e90" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 367px; max-height: 98px;"><div class="aspect-ratio-fill" style="padding-bottom: 26.700000000000003%;"></div><img class="graf-image" data-image-id="1*QU1hX4iLJrmtG__MCnaurA.png" data-width="367" data-height="98" src="https://cdn-images-1.medium.com/max/800/1*QU1hX4iLJrmtG__MCnaurA.png"></div><figcaption class="imageCaption">In WS, average load was 35 MBs</figcaption></figure><h4 name="3919" id="3919" class="graf--h4 graf-after--figure">Performance limit</h4><p name="8f20" id="8f20" class="graf--p graf-after--h4">However, when I connect <strong class="markup--strong markup--p-strong">140</strong> <strong class="markup--strong markup--p-strong">clients</strong>, the memory usage starts to increment without the number of clients or the data size changing. Garbage Collector kicks in very frequently and gets more aggressive over time (sometimes a couple of times per second), eating up CPU time and desperately trying to free memory. Memory usage would reach ~1GB, then heartbeats would fail and clients would start to lose connection.</p><figure name="cd9c" id="cd9c" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 125px;"><div class="aspect-ratio-fill" style="padding-bottom: 17.9%;"></div><img class="graf-image" data-image-id="1*VSpub4TEOxu4RRnOtJ0uXg.png" data-width="783" data-height="140" data-action="zoom" data-action-value="1*VSpub4TEOxu4RRnOtJ0uXg.png" src="https://cdn-images-1.medium.com/max/800/1*VSpub4TEOxu4RRnOtJ0uXg.png"></div></figure><figure name="0ddb" id="0ddb" class="graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 829px;"><div class="aspect-ratio-fill" style="padding-bottom: 118.39999999999999%;"></div><img class="graf-image" data-image-id="1*pMFOD0TlXv0aiq2VbdnDOQ.png" data-width="881" data-height="1043" data-action="zoom" data-action-value="1*pMFOD0TlXv0aiq2VbdnDOQ.png" src="https://cdn-images-1.medium.com/max/800/1*pMFOD0TlXv0aiq2VbdnDOQ.png"></div><figcaption class="imageCaption">Heap size stops increasing when connections start dropping, and keeps stable as Socket.IO clients tries to connect back. Also notice the very low event loop latency.</figcaption></figure><figure name="68f5" id="68f5" class="graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 366px; max-height: 97px;"><div class="aspect-ratio-fill" style="padding-bottom: 26.5%;"></div><img class="graf-image" data-image-id="1*uqQLvLCtsaADgJbWGxay_Q.png" data-width="366" data-height="97" src="https://cdn-images-1.medium.com/max/800/1*uqQLvLCtsaADgJbWGxay_Q.png"></div></figure><p name="2c84" id="2c84" class="graf--p graf-after--figure">It’s time to debug!</p><p name="54b7" id="54b7" class="graf--p graf-after--p">I used <a href="https://hacks.mozilla.org/2012/11/tracking-down-memory-leaks-in-node-js-a-node-js-holiday-season/" data-href="https://hacks.mozilla.org/2012/11/tracking-down-memory-leaks-in-node-js-a-node-js-holiday-season/" class="markup--anchor markup--p-anchor" rel="nofollow">Mozilla’s memwatch module</a> to detect memory leaks and take heap dumps to inspect the data. I found out that somehow 10MB Buffer objects would stack up constantly, you can find more details in <a href="http://stackoverflow.com/questions/20566673/memory-leak-when-emitting-messages-with-socket-io-node-js-zmq" data-href="http://stackoverflow.com/questions/20566673/memory-leak-when-emitting-messages-with-socket-io-node-js-zmq" class="markup--anchor markup--p-anchor" rel="nofollow">my Stackoverflow Question</a>. I couldn’t figure out why this would happen, but I think due to some cumulative CPU intensive operations, event loop response slows down and operations (sending messages) stack up in the queue. Being stuck, I decided to try out <a href="https://github.com/sockjs/sockjs-client" data-href="https://github.com/sockjs/sockjs-client" class="markup--anchor markup--p-anchor" rel="nofollow">Sock.</a>js.</p><p name="034b" id="034b" class="graf--p graf-after--p">I must admit my Sock.js adventure didn’t last long after discovering that Sock.js does not support connection query strings. This would mean that I’d need to amend my code so that after clients connect, they’d need to send a seperate message to pass the parameter(s), and this was a bit turn off. Next, I decided to give <a href="https://github.com/LearnBoost/engine.io" data-href="https://github.com/LearnBoost/engine.io" class="markup--anchor markup--p-anchor" rel="nofollow">Engine.IO</a> a try.</p><h3 name="8674" id="8674" class="graf--h3 graf-after--p">Engine.IO (v 0.7.12)</h3><p name="2309" id="2309" class="graf--p graf-after--h3">As far as I’ve seen, both Engine.IO and Socket.IO are mainly developed by <a href="https://github.com/guille" data-href="https://github.com/guille" class="markup--anchor markup--p-anchor" rel="nofollow">Guillermo Rauch</a>, and Engine.IO is a lower level library. Socket.IO v0.9 appears to be somewhat outdated and Engine.IO is the interim successor until Socket.IO v1.0 is released — which will use Engine.IO. One major difference is that Engine.IO always establishes a long-polling connection first, then tries to <strong class="markup--strong markup--p-strong">upgrade</strong> to better transports. This makes it resilient to firewalls and proxies, gives more predictable results and less frequent reconnecting. All other differences are very well listed on <a href="https://github.com/LearnBoost/engine.io#goals" data-href="https://github.com/LearnBoost/engine.io#goals" class="markup--anchor markup--p-anchor" rel="nofollow">project’s readme</a>. As you see, Engine.IO first started to connect via long-polling, then connected via WebSockets:</p><figure name="0a2a" id="0a2a" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 212px;"><div class="aspect-ratio-fill" style="padding-bottom: 30.3%;"></div><img class="graf-image" data-image-id="1*bpiyQzS3nXssOps_RXG9QQ.png" data-width="935" data-height="283" data-action="zoom" data-action-value="1*bpiyQzS3nXssOps_RXG9QQ.png" src="https://cdn-images-1.medium.com/max/800/1*bpiyQzS3nXssOps_RXG9QQ.png"></div><figcaption class="imageCaption">Notice the ‘transport’ parameter</figcaption></figure><p name="d841" id="d841" class="graf--p graf-after--figure">However its client library <strong class="markup--strong markup--p-strong">does not try to reconnect</strong> when connection terminates.</p><p name="bea6" id="bea6" class="graf--p graf-after--p">Same load test with same values (<strong class="markup--strong markup--p-strong">160KB sent every second to 120 clients)</strong> looks like:</p><figure name="1010" id="1010" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 833px;"><div class="aspect-ratio-fill" style="padding-bottom: 119%;"></div><img class="graf-image" data-image-id="1*sAStZUaDk2kbVs8_7g3P2A.png" data-width="885" data-height="1053" data-action="zoom" data-action-value="1*sAStZUaDk2kbVs8_7g3P2A.png" src="https://cdn-images-1.medium.com/max/800/1*sAStZUaDk2kbVs8_7g3P2A.png"></div></figure><figure name="ccea" id="ccea" class="graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 371px; max-height: 97px;"><div class="aspect-ratio-fill" style="padding-bottom: 26.1%;"></div><img class="graf-image" data-image-id="1*gRssPL3bttWdamv3oLd9SA.png" data-width="371" data-height="97" src="https://cdn-images-1.medium.com/max/800/1*gRssPL3bttWdamv3oLd9SA.png"></div></figure><h4 name="760e" id="760e" class="graf--h4 graf-after--figure">Performance limit</h4><p name="f0a3" id="f0a3" class="graf--p graf-after--h4">Let’s see what happens when we increase connection size. Engine.IO’s performance proved to be better for my application: I could load test with <strong class="markup--strong markup--p-strong">230 concurrent connections</strong>, with (again) each one sent 165KB of data every second. Any number above 230 connections resulted in the application using massive amounts of data — up to 2GB (the same issue with Socket.IO implementation). Then connections would start dropping until 160 connections are remaining, and obviously this results in less resource usage. You can see this drop in the charts below. Remember in Engine.IO client implementation, clients don’t reconnect once they are disconnected.</p><figure name="437c" id="437c" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 830px;"><div class="aspect-ratio-fill" style="padding-bottom: 118.6%;"></div><img class="graf-image" data-image-id="1*VmsuyauLLwN_uDOmcop6Vw.png" data-width="891" data-height="1057" data-action="zoom" data-action-value="1*VmsuyauLLwN_uDOmcop6Vw.png" src="https://cdn-images-1.medium.com/max/800/1*VmsuyauLLwN_uDOmcop6Vw.png"></div></figure><figure name="5106" id="5106" class="graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 369px; max-height: 103px;"><div class="aspect-ratio-fill" style="padding-bottom: 27.900000000000002%;"></div><img class="graf-image" data-image-id="1*45gGF8eycV9Q1MwWBsBnBg.png" data-width="369" data-height="103" src="https://cdn-images-1.medium.com/max/800/1*45gGF8eycV9Q1MwWBsBnBg.png"></div></figure><h3 name="cfcd" id="cfcd" class="graf--h3 graf-after--figure">Primus (v 1.5.0)</h3><p name="5c87" id="5c87" class="graf--p graf-after--h3">When I was about to end my research and development, I came across <a href="http://primus.io/" data-href="http://primus.io/" class="markup--anchor markup--p-anchor" rel="nofollow">Primus</a>. It is developed by <a href="https://github.com/3rd-Eden" data-href="https://github.com/3rd-Eden" class="markup--anchor markup--p-anchor" rel="nofollow">Arnout Kazemier</a> who is an active collabrator in some of the projects mentioned above. Primus actually lets you do what I have done all this time (changing WebSocket technologies for the business logic) dead easy: only with a single line of code. It has a similar syntax with all of the other frameworks, reconnects clients when connection terminates, and has lots of cool methods and structures — like rooms.</p><figure name="a441" id="a441" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 156px;"><div class="aspect-ratio-fill" style="padding-bottom: 22.3%;"></div><img class="graf-image" data-image-id="1*0vgMgH7VO7tAtG5z_m_UoQ.png" data-width="716" data-height="160" data-action="zoom" data-action-value="1*0vgMgH7VO7tAtG5z_m_UoQ.png" src="https://cdn-images-1.medium.com/max/800/1*0vgMgH7VO7tAtG5z_m_UoQ.png"></div><figcaption class="imageCaption">Primus connects</figcaption></figure><p name="9972" id="9972" class="graf--p graf-after--figure">Here are the test results for <strong class="markup--strong markup--p-strong">einaros/ws</strong> library with Primus (<strong class="markup--strong markup--p-strong">160KB sent every second to 120 clients)</strong>:</p><figure name="7182" id="7182" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 831px;"><div class="aspect-ratio-fill" style="padding-bottom: 118.8%;"></div><img class="graf-image" data-image-id="1*UA6v1l5csnkmGJQ2B4x46A.png" data-width="879" data-height="1044" data-action="zoom" data-action-value="1*UA6v1l5csnkmGJQ2B4x46A.png" src="https://cdn-images-1.medium.com/max/800/1*UA6v1l5csnkmGJQ2B4x46A.png"></div></figure><figure name="d353" id="d353" class="graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 372px; max-height: 101px;"><div class="aspect-ratio-fill" style="padding-bottom: 27.200000000000003%;"></div><img class="graf-image" data-image-id="1*HvoLp6qUWXItPtXC3JYlwg.png" data-width="372" data-height="101" src="https://cdn-images-1.medium.com/max/800/1*HvoLp6qUWXItPtXC3JYlwg.png"></div></figure><p name="0712" id="0712" class="graf--p graf-after--figure">Compared to native implementation, it has a higher CPU usage and event loop latency, but a bit lower memory consumption. However, something unexpected happens after 10 minutes pass:</p><figure name="12ad" id="12ad" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 841px;"><div class="aspect-ratio-fill" style="padding-bottom: 120.10000000000001%;"></div><img class="graf-image" data-image-id="1*Y7qKnDCQYAuDmFobs4xHUg.png" data-width="881" data-height="1058" data-action="zoom" data-action-value="1*Y7qKnDCQYAuDmFobs4xHUg.png" src="https://cdn-images-1.medium.com/max/800/1*Y7qKnDCQYAuDmFobs4xHUg.png"></div></figure><p name="0fae" id="0fae" class="graf--p graf-after--figure">Event loop average drops to almost 0ms, but memory allocation starts to stack up, reaching GBs in minutes. This happened twice in two of my tries. I decided to leave this instead of digging deeper. (<em class="markup--em markup--p-em">Please see Arnout’s comment about this issue on the right hand side</em>)</p><p name="fc32" id="fc32" class="graf--p graf-after--p">As Primus is a wrapper for socket libraries, I decided to use a native library just to have things on a lower level.</p><h3 name="8420" id="8420" class="graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">Looking back: Performance limit of einaros/ws</strong></h3><p name="e661" id="e661" class="graf--p graf-after--h3">At this point, I wanted to look back and see at what rate <em class="markup--em markup--p-em">einaros/ws</em> implementation (which I ditched as it doesn’t support other connection types) would crash.</p><p name="52cc" id="52cc" class="graf--p graf-after--p">By handling <strong class="markup--strong markup--p-strong">410</strong> concurrent connections, sending 165KB data to each every second, <em class="markup--em markup--p-em">einaros/ws</em>’s performance was far more superior than any other framework I tried. Compare it with Socket.IO’s max <strong class="markup--strong markup--p-strong">140</strong> connections and Engine.IO’s max <strong class="markup--strong markup--p-strong">230</strong> connections. <em class="markup--em markup--p-em">einaros/ws</em> would fail at 415 connections in the same way with other implementations: memory usage would stack up seemingly almost indefinitely (I waited until 8GB consumption before killing the process).</p><figure name="8e7c" id="8e7c" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder"><img class="graf-image" data-image-id="1*0V-fb_dFkoxsBAneeIG--w.png" src="https://cdn-images-1.medium.com/max/800/1*0V-fb_dFkoxsBAneeIG--w.png"></div></figure><figure name="cb82" id="cb82" class="graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 369px; max-height: 97px;"><div class="aspect-ratio-fill" style="padding-bottom: 26.3%;"></div><img class="graf-image" data-image-id="1*e0d2NB7dIRexSSagezudPw.png" data-width="369" data-height="97" src="https://cdn-images-1.medium.com/max/800/1*e0d2NB7dIRexSSagezudPw.png"></div></figure><h3 name="d157" id="d157" class="graf--h3 graf-after--figure">Final decision on the framework</h3><p name="2c7c" id="2c7c" class="graf--p graf-after--h3">In summary, these test results showed that <strong class="markup--strong markup--p-strong">Engine.IO</strong> looks like the better choice for my application. It supports different connection types apart from WebSockets, and has a significantly better memory usage compared to others.</p><figure name="9809" id="9809" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 129px;"><div class="aspect-ratio-fill" style="padding-bottom: 18.4%;"></div><img class="graf-image" data-image-id="1*OlkZJXDjJ62aelM9Zlc_Dg.png" data-width="724" data-height="133" data-action="zoom" data-action-value="1*OlkZJXDjJ62aelM9Zlc_Dg.png" src="https://cdn-images-1.medium.com/max/800/1*OlkZJXDjJ62aelM9Zlc_Dg.png"></div></figure><p name="264e" id="264e" class="graf--p graf-after--figure">The difference in memory seems like a good trade of for losing the functionality of clients not reconnecting in a connection failure. At least, until Socket.IO 1.0 is released.</p><h3 name="7f37" id="7f37" class="graf--h3 graf-after--p">Changing the flow based on limitations</h3><p name="e173" id="e173" class="graf--p graf-after--h3">The aim when starting this project was to have a system that can support thousands, even 10 thousand concurrent users. It seems, with 165KB of data sent every second, this won’t be possible. This made me decide to decrease the data size, and introduce a delta model, in which the application would send only the new JSON content instead of the whole object each time.</p><h3 name="ba37" id="ba37" class="graf--h3 graf-after--p">Test 1: The impact of data size</h3><p name="39db" id="39db" class="graf--p graf-after--h3">I ran the a load test that uses <strong class="markup--strong markup--p-strong">5KB of data, sent to 4000 users every second</strong>. 5KB of JSON makes around 200 lines of data with reasonable string length. I’ve also modified the test so that 10 new clients connect every second. The data throughput is equivalent to 20MB sent per second.</p><figure name="8038" id="8038" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 828px;"><div class="aspect-ratio-fill" style="padding-bottom: 118.19999999999999%;"></div><img class="graf-image" data-image-id="1*beMMwc93qJV0rX1qwhoYxQ.png" data-width="888" data-height="1050" data-action="zoom" data-action-value="1*beMMwc93qJV0rX1qwhoYxQ.png" src="https://cdn-images-1.medium.com/max/800/1*beMMwc93qJV0rX1qwhoYxQ.png"></div></figure><p name="2d98" id="2d98" class="graf--p graf-after--figure">We will take these values as a base and see what happens when we keep throughput same and change some variables.</p><h3 name="4097" id="4097" class="graf--h3 graf-after--p">Test 2: The impact of concurrent connection size</h3><p name="6fd5" id="6fd5" class="graf--p graf-after--h3">In this test, <strong class="markup--strong markup--p-strong">2000 users</strong> connected to the server, and received <strong class="markup--strong markup--p-strong">10KBs</strong> <strong class="markup--strong markup--p-strong">of data every second</strong>. Again in this case, 20MB is sent every second.</p><figure name="a6f4" id="a6f4" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 833px;"><div class="aspect-ratio-fill" style="padding-bottom: 119%;"></div><img class="graf-image" data-image-id="1*mYnz2FhmPkLXTJWLDf9EoQ.png" data-width="891" data-height="1060" data-action="zoom" data-action-value="1*mYnz2FhmPkLXTJWLDf9EoQ.png" src="https://cdn-images-1.medium.com/max/800/1*mYnz2FhmPkLXTJWLDf9EoQ.png"></div></figure><p name="1c68" id="1c68" class="graf--p graf-after--figure">Compare these results with test one. As you see, <strong class="markup--strong markup--p-strong">doubling the data size and decreasing the connection size by half ended up in 20% lower memory consumption, 35% lower CPU usage and 75% less event loop latency</strong>.</p><h3 name="6077" id="6077" class="graf--h3 graf-after--p">Test 3: The impact of data broadcasting frequency</h3><p name="8ee9" id="8ee9" class="graf--p graf-after--h3">In this test, <strong class="markup--strong markup--p-strong">4000</strong> <strong class="markup--strong markup--p-strong">users</strong> connected to the server, and received <strong class="markup--strong markup--p-strong">10KB of data every 2 seconds</strong>. Again, this equals to 20MB sent every second.</p><figure name="5828" id="5828" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 833px;"><div class="aspect-ratio-fill" style="padding-bottom: 119%;"></div><img class="graf-image" data-image-id="1*Y91GPYv2Mg6FYiOqDq2TKQ.png" data-width="881" data-height="1048" data-action="zoom" data-action-value="1*Y91GPYv2Mg6FYiOqDq2TKQ.png" src="https://cdn-images-1.medium.com/max/800/1*Y91GPYv2Mg6FYiOqDq2TKQ.png"></div></figure><p name="fb8c" id="fb8c" class="graf--p graf-after--figure">Compare these results with the first test. It seems <strong class="markup--strong markup--p-strong">doubling data size and decreasing frequency of data sent by half results in 25% lower CPU usage, but more or less the same memory consumption and event loop latency.</strong></p><h3 name="bd14" id="bd14" class="graf--h3 graf-after--p">Conclusion</h3><p name="ed97" id="ed97" class="graf--p graf-after--h3">We do not really have a direct control over how many connections the application will have <strong class="markup--strong markup--p-strong">if we have one server</strong>, thus it seems we can only play around with the size of data sent, and how frequent we send this data. These tests show that <strong class="markup--strong markup--p-strong">for a constant throughput, (at least) for Engine.IO,</strong> <strong class="markup--strong markup--p-strong">the number of connections have the biggest impact on performance</strong>, <strong class="markup--strong markup--p-strong">then comes reducing size of data, and lastly reducing frequency of data sent</strong>. Sending larger data in less frequency appears to yield better performance. It’s a double-sided sword though: increasing size of data packets was what made my applications crash as well.</p><p name="0463" id="0463" class="graf--p graf-after--p graf--last">So I think the best way of balancing it is to estimate the max number of concurrent users in the long run (at least a couple of years forward), finding the maximum data size that can be used with that number, and then decrease the frequency of sending data if possible — but as said this is not that critical. After this point, as connection number has the biggest impact on the performance, by using a load balancer, adding <strong class="markup--strong markup--p-strong">more application instances</strong> should increase the performance more than any other method.</p></div></div></section><section name="ffb7" class=" section--body section--last"><div class="section-divider layoutSingleColumn"><hr class="section-divider"></div><div class="section-content"><div class="section-inner layoutSingleColumn"><p name="cc4e" id="cc4e" class="graf--p graf--first"><a href="https://news.ycombinator.com/item?id=7030100" data-href="https://news.ycombinator.com/item?id=7030100" class="markup--anchor markup--p-anchor" rel="nofollow">Discuss this on Hacker News</a></p><p name="4b8c" id="4b8c" class="graf--p graf-after--p graf--last"><em class="markup--em markup--p-em">Acknowledgements: </em><a href="https://github.com/kkoopa" data-href="https://github.com/kkoopa" class="markup--anchor markup--p-anchor" rel="nofollow"><em class="markup--em markup--p-em">Benjamin Byholm</em></a><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> </em></strong><em class="markup--em markup--p-em">for reviewing and commenting on this article with his insights on caching, multiple servers, and V8 memory usage. </em><a href="https://medium.com/@3rdEden" data-href="https://medium.com/@3rdEden" class="markup--anchor markup--p-anchor" title="Go to the profile of Arnout Kazemier"><em class="markup--em markup--p-em">Arnout Kazemier</em></a><em class="markup--em markup--p-em"> for his helpful comments, </em><a href="https://github.com/nicokaiser" data-href="https://github.com/nicokaiser" class="markup--anchor markup--p-anchor" rel="nofollow"><em class="markup--em markup--p-em">Nico Kaiser</em></a><em class="markup--em markup--p-em"> for his feedback, </em><a href="https://github.com/guille" data-href="https://github.com/guille" class="markup--anchor markup--p-anchor" rel="nofollow"><em class="markup--em markup--p-em">Guillermo Rauch</em></a><em class="markup--em markup--p-em"> and </em><a href="https://github.com/davedoesdev" data-href="https://github.com/davedoesdev" class="markup--anchor markup--p-anchor" rel="nofollow"><em class="markup--em markup--p-em">David Halls</em></a><em class="markup--em markup--p-em"> for taking the time to read the draft.</em></p></div></div></section></main><footer class="postArticle-footer"><div class="postActionsFooter container u-size740"><div class="row"><div class="col u-xs-size12of12"></div></div><div class="row"><div class="col u-xs-size12of12 js-postTags"><div class="postTags"><div class="tags tags--postTags tags--borderless"></div></div></div></div><div class="row js-postActionsFooter"><div class="postActions col u-xs-size12of12"><div class="u-floatLeft buttonSet buttonSet--withLabels"><div class="buttonSet-inner"><div class="js-actionRecommend" data-post-id="b63bfca0539" data-size="29px"><button class="button button--primary button--large button--chromeless button--withIcon button--withSvgIcon"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it"data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/b63bfca0539"><span class="button-defaultState"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--heart svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-heart-29px-p0"></use></svg></span><span class="button-activeState"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--heartFilled svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-heartFilled-29px-p0"></use></svg></span></button><button class="button button--chromeless"  data-action="show-recommends" data-action-value="b63bfca0539">166</button></div></div><div class="buttonSet-inner"><button class="button button--large button--dark button--chromeless button--withIcon button--withSvgIcon"  data-action="scroll-to-responses"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--response svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-response-29px-p0"></use></svg></button><button class="button button--chromeless"  data-action="scroll-to-responses">4</button></div></div><div class="u-floatRight buttonSet buttonSet--narrow"><button class="button button--large button--dark button--chromeless button--withIcon button--withSvgIcon"  data-action="share-on-twitter"value="b63bfca0539"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--twitter svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-twitter-29px-p0"></use></svg></button><button class="button button--large button--dark button--chromeless button--withIcon button--withSvgIcon"  data-action="share-on-facebook"value="b63bfca0539"><svg viewBox="0 0 29 29" width="29" height="29" class="svgIcon svgIcon--facebook svgIcon-size--29px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-facebook-29px-p0"></use></svg></button><button class="button button--large button--dark button--chromeless button--withIcon js-moreActionsButton button--withSvgIcon"  title="More actions" aria-label="More actions" data-action="more-actions"><svg viewBox="0 0 25 25" width="25" height="25" class="svgIcon svgIcon--more svgIcon-size--25px"><use class="svgIcon-use svgIcon-use--part0" xlink:href="#svg-more-25px-p0"></use></svg></button></div></div></div></div><div class="container u-size740"><div class="row postFooter-info2"><div class="col u-xs-size12of12"><hr class="postFooter-infoDivider"></div></div><div class="row js-postFooterInfo"><div class="col u-xs-size12of12"><li class="card card-user"><div class="u-floatRight"><span class="followState js-followState buttonSet-inner" data-user-id="c1855caedf"><button class="button button--small u-noUserSelect button--withChrome button--withHover button--unblock js-unblockButton" data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome button--follow js-followButton" data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/c1855caedf" data-action-source="footer_card_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="card-imageWrapper "><a class="link avatar"  href="https://medium.com/@denizozger?source=footer_card" title="Go to the profile of Deniz Ozger" aria-label="Go to the profile of Deniz Ozger" data-action-source="footer_card" data-user-id="c1855caedf" dir="auto"><img src="https://cdn-images-1.medium.com/fit/c/60/60/0*sd4q2ml2nYkrQGgb.jpeg" class="avatar-image avatar-image--small" alt="Go to the profile of Deniz Ozger"></a></div><div class="card-content"><h3 class="card-name"><a class="link link--primary"  href="https://medium.com/@denizozger" property="cc:attributionName" title="Go to the profile of Deniz Ozger" aria-label="Go to the profile of Deniz Ozger" rel="author cc:attributionUrl" data-user-id="c1855caedf" dir="auto">Deniz Ozger</a></h3><p class="card-description">Web Engineer <a href="http://twitter.com/Klarismo" target="_blank" title="Twitter profile for @Klarismo">@Klarismo</a>, Co-founder of <a href="http://twitter.com/MostTalkedLive" target="_blank" title="Twitter profile for @MostTalkedLive">@MostTalkedLive</a></p></div></li></div></div></div><div class="responsesWrapper supplementalPostContent js-responsesWrapper"></div><div class="post-footer supplementalPostContent js-readNext"></div></footer></article><div class="promoCardWrapper js-promoCardWrapper"><div class="promoCard"><button class="button button--chromeless button--close"  data-action="popup-dismiss">&times;</button><div class="promoCard-header">Don’t miss Deniz Ozger’s next story</div><div class="u-floatRight"><span class="followState js-followState buttonSet-inner" data-user-id="c1855caedf"><button class="button u-noUserSelect button--withChrome button--withHover button--unblock js-unblockButton" data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="user_follow_popup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary u-noUserSelect button--withChrome button--follow js-followButton" data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/c1855caedf" data-action-source="user_follow_popup_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="avatar"><img src="https://cdn-images-1.medium.com/fit/c/40/40/0*sd4q2ml2nYkrQGgb.jpeg" class="avatar-image avatar-image--smaller" alt="Deniz Ozger"><span class="avatar-text">Deniz Ozger</span></div></div></div></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","bestOfFirstSlug":"may-2013","bestOfLatestSlug":"november-2015","buildLabel":"18659-b02cc8c","currentUser":{"userId":"lo_6f7b140a913d","isVerified":"","subscriberEmail":""},"currentUserHasUnverifiedEmail":false,"facebookKey":"542599432471018","facebookScope":["public_profile","email","user_friends"],"isAuthenticated":false,"isCurrentUserVerified":"","loadingPlaceholderImg":"https://cdn-static-1.medium.com/_/fp/img/media-loading-placeholder.b31hiO4ynbDLRrXWEFF4aQ.png","mediumTwitterScreenName":"medium","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/js/main-base.bundle.PMFYxE6gzVH0ZXzyorUr1A.js","notes":"https://cdn-static-1.medium.com/_/fp/js/main-notes.bundle.cyFDLAWmWiJgjmGRZxcrsg.js","posters":"https://cdn-static-1.medium.com/_/fp/js/main-posters.bundle.LweHXgFmA7TsxPWxZy9DVQ.js","common-async":"https://cdn-static-1.medium.com/_/fp/js/main-common-async.bundle.Zlk_NvrG4CMof9DpNoJbBg.js","stats":"https://cdn-static-1.medium.com/_/fp/js/main-stats.bundle.pbXGQaRCi7v3Fb_x6YK8xw.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/js/main-misc-screens.bundle.MSG7F6g6u8wNKQTskHPHXQ.js"},"postColumnWidth":700,"previewConfig":{"weightThreshold":1,"weightEmptyParagraph":0,"weightIframeParagraph":0.8,"weightImageParagraph":0.51,"weightTextParagraph":0.08,"weightBq":0.003,"weightH":0.005,"weightP":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15,"experimentImagesInsetCenter":false,"previewConfigVariantA":{"experimentImagesInsetCenter":true},"previewConfigVariantB":{"weightThreshold":10,"detectTitle":false}},"productName":"Medium","supportsEdit":false,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1449071156859:cf1a25b89721","useragent":{"browser":"wget","family":"","os":"","version":1.1,"supportsDesktopEdit":false,"supportsMobileEdit":false,"supportsInteract":false,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":false,"isTier1":false,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":false,"supportsVhUnits":false,"ruinsViewportSections":false,"supportsHtml5Video":false,"supportsMagicUnderlines":false,"isFacebook":false,"isWebView":false,"isFacebookWebView":false,"supportsSvgExternalResources":false,"supportsScrollableMetabar":false,"supportsProgressiveMedia":false,"isGoogle":false},"variants":{"allow_access":true,"allow_signup":true,"can_vote":true,"can_update_settings":true,"can_send_push_notifications":true,"can_export_data":true,"enable_notes":true,"allow_test_auth":"disallow","enable_email_login":true,"enable_email_registration":true,"enable_spam_detection":true,"enable_post_licensing":true,"filter_other_languages":true,"use_experimental_css":true,"can_resume_from_last_read_location":true,"can_report_bad_posts":true,"enable_embeds":true,"enable_recommend_notes":true,"enable_recommend_notes_composition":true,"use_full_width_images":true,"upload_multiple_files":true,"can_follow_users":true,"can_block_users":true,"enable_custom_push_notification_prompts_ios":true,"onboarding_connect_addtional_social_accounts_enabled_ios":true,"allow_request_account_deletion":true,"enable_bookmarks_list_ios":true,"see_featured_post_tab":true,"receive_rec_note_pushes":true,"receive_post_published_pushes":true,"receive_mention_pushes":true,"enable_account_conversion":true,"use_new_scheduled_delivery_flow":true,"feed_homepage":true,"enable_collection_subscription_fanout":true,"welcome_post_url":"https://medium.com/about/about-medium-9eac453da935","google_search":true,"signin_services":"twitter,facebook,google","signup_services":"twitter,facebook,google","mobile_app_promotion":"dialog","enable_bing_search":true,"enable_algolia_search":true,"show_tagged_posts_in_search":true,"enable_respond_to_web":true,"drafts_unauth":true,"friends_only_quotes":true,"enable_search_ios":true,"enable_connect_social_accounts_from_settings_ios":true,"enable_new_cover_flow_ios":true,"enable_rating_prompt":true,"enable_post_show_refactor":true,"enable_your_stories_more_actions":true,"enable_user_search_with_bing":true,"enable_drop_caps":true,"enable_session_cookie_encryption":true,"enable_follow_tags":true,"enable_tabbed_homepage_ios":true,"enable_editors_can_pull_stories":true,"enable_email_capture_flow_ios":true,"enable_send_pub_newsletters":true,"enable_receive_pub_newsletters":true,"enable_new_onboarding_flow_ios":true,"enable_follow_tags_from_post_list_ios":true,"enable_embedded_onboarding_education_and_login_ios":true,"enable_contextual_recommend_education_ios":true,"enable_tag_follow_onboarding":true,"your_top_stories_source":"similar-posts","follower_suggestion_source":"friends-of-friends","enable_query_by_in_response_to_post_id":true,"enable_gif_to_video_ios":true,"enable_international_typographic_quotes_through_icu_ios":true,"enable_service_worker":true,"android_rating_prompt_recommend_threshold":5,"number_of_top_stories":3,"number_of_in_stream_ts4u":3,"number_of_in_stream_global_top_stories":3,"source_of_in_stream_ts4u":"friends-rec-7d","enable_top_stories_in_stream":true,"enable_top_stories_in_stream_on_ios":true,"enable_top_stories_in_stream_on_android":true,"enable_post_recommend_threshold_in_stream":true,"enable_response_recommend_threshold_in_stream":true,"post_recommend_threshold":1,"response_recommend_threshold":2,"new_stream_reasons":true,"google_sign_in_backend":true,"google_sign_in_android":true,"enable_quote_feed_write":true,"enable_pile_on_activity":true,"enable_onboarding":true,"enable_rds_activity":true,"enable_rds_activity_read":true,"enable_activity_rollup":true,"activity_rollup_method":"all","enable_simple_open_in_app":true,"custom_miro_url":"https://cdn-images-1.medium.com","ios_custom_miro_url":"https://cdn-images-1.medium.com","enable_friends_recommends_plugin":true,"enable_write_stats_cache":true,"enable_populate_post_stats":true,"enable_most_recommended_response":true,"no_push_notification_for_responses":true,"receive_follow_pushes":true,"receive_recommend_pushes":true,"receive_response_pushes":true,"receive_highlight_pushes":true,"new_google_flow":true,"enable_small_first_page":true,"enable_response_email2":true,"fetch_with_relation_index":true,"enable_screen_placeholders":true,"user_popover_experiment":true,"enable_post_screen_placeholders":true,"enable_profile_screen_placeholders":true,"reengagement_notification_duration":3,"enable_infinite_scroll_placeholders":true,"enable_context_cards":true,"enable_progressive_media":true,"enable_oauth_api":true,"enable_oauth_token_self_issuance":true,"enable_oauth_app_creation":true,"list_of_lists_bucket":"default","enable_zoomable":true,"use_new_push_notification_logic":true,"enable_send_ios_pushes_using_channel_ids":true,"explore_tab_ios_posts_per_section_limit":4,"enable_quotes_in_one_stream":true,"enable_user_social_count_healing":true,"enable_social_counts_from_user_stat_total":true,"show_social_buttons_on_logged_out_post_footer":true,"enable_preview_footer_two":true,"show_sponsored_read_next":true,"track_with_social_id":true,"filter_responses_in_stream":true,"top_stories_2_dot_0":true,"disable_inherit_tags_inline":true,"sponsored_read_next_cohort":"a"},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","teamName":"Team Medium","fp":{"/img/default-avatar.png":"https://cdn-static-1.medium.com/_/fp/img/default-avatar.dmbNkD5D-u45r44go_cf0g.png","/img/default-preview-image.png":"https://cdn-static-1.medium.com/_/fp/img/default-preview-image.IsBK38jFAJBlWifMLO4z9g.png","/img/email/app_store_badge@2x.png":"https://cdn-static-1.medium.com/_/fp/img/email/app_store_badge@2x.8bDQGNMm-Xs7Hz6WA2XquQ.png","/img/email/app-devices@2x.png":"https://cdn-static-1.medium.com/_/fp/img/email/app-devices@2x.Ewl5-si-nhkLKZFIFSgrOw.png","/img/email/check1.png":"https://cdn-static-1.medium.com/_/fp/img/email/check1.0DM77li7vZhq5o2V9cVYLQ.png","/img/email/check2.png":"https://cdn-static-1.medium.com/_/fp/img/email/check2.GLlNusQmn1hwo9WDN-gE1w.png","/img/email/check3.png":"https://cdn-static-1.medium.com/_/fp/img/email/check3.7VxOUVMXAVbHRRnzMrJ_5A.png","/img/email/email-logo.png":"https://cdn-static-1.medium.com/_/fp/img/email/email-logo.x91rxfZYzIT9OJ5-ySD30A.png","/img/email/fb_logo.png":"https://cdn-static-1.medium.com/_/fp/img/email/fb_logo.Q0M98YwNTu77gLWTK6-RyQ.png","/img/email/google_play_badge@2x.png":"https://cdn-static-1.medium.com/_/fp/img/email/google_play_badge@2x.iWEWlt5_Qj20rr79-IGEBQ.png","/img/email/heart.png":"https://cdn-static-1.medium.com/_/fp/img/email/heart._hlyuYQiuuTWrRmDnDphJA.png","/img/email/heart@2x.png":"https://cdn-static-1.medium.com/_/fp/img/email/heart@2x.qvCTX1XHNpntqxt01oypQw.png","/img/email/heart1.png":"https://cdn-static-1.medium.com/_/fp/img/email/heart1.rnGEmSwcGUhztl_zSU7l6Q.png","/img/email/heart2.png":"https://cdn-static-1.medium.com/_/fp/img/email/heart2.HBiLu3koIYsKjjKroohgbA.png","/img/email/heart3.png":"https://cdn-static-1.medium.com/_/fp/img/email/heart3.AIJBOHw11HuhdClVJNtmtg.png","/img/email/large.png":"https://cdn-static-1.medium.com/_/fp/img/email/large.4EIhZbIk5sgqYSoB4YPmUA.png","/img/email/response.png":"https://cdn-static-1.medium.com/_/fp/img/email/response.5ZuN24N5XqS7ofHKg1lKXw.png","/img/email/response@2x.png":"https://cdn-static-1.medium.com/_/fp/img/email/response@2x.xzKQM4FzSurAVkghLQQWkA.png","/img/email/twitter_logo.png":"https://cdn-static-1.medium.com/_/fp/img/email/twitter_logo.Pz4a3o9WMU5QioxLKcyFhQ.png","/img/email/unlisted.png":"https://cdn-static-1.medium.com/_/fp/img/email/unlisted.ikh8R2LElOz_1YM8A2Db4g.png","/img/email/welcome-heart.png":"https://cdn-static-1.medium.com/_/fp/img/email/welcome-heart.6BRCOGcwGeOCBTql8pbq2g.png","/img/email/welcome-response.png":"https://cdn-static-1.medium.com/_/fp/img/email/welcome-response.iWVQLjiUG5pyQrPyGiYEpw.png","/img/email/welcome-write.png":"https://cdn-static-1.medium.com/_/fp/img/email/welcome-write.afdGsuE6YDk3HkaIASRl0w.png","/img/help/add-media-start.gif":"https://cdn-static-1.medium.com/_/fp/img/help/add-media-start.GXmqQ2Svt1WfZGIZSM93tg.gif","/img/help/add-media.gif":"https://cdn-static-1.medium.com/_/fp/img/help/add-media.SZH2LBmkwVExuhozFfVvYg.gif","/img/help/embed-start.gif":"https://cdn-static-1.medium.com/_/fp/img/help/embed-start.EBJ2PcWFJuYopsQV4wwklA.gif","/img/help/embed.gif":"https://cdn-static-1.medium.com/_/fp/img/help/embed.1BM0Di9vd91Kv8fLioJabw.gif","/img/help/text-highlight-start.gif":"https://cdn-static-1.medium.com/_/fp/img/help/text-highlight-start.AvTbakaFuUCd05YoMECoMQ.gif","/img/help/text-highlight.gif":"https://cdn-static-1.medium.com/_/fp/img/help/text-highlight.XVChoKYZ1-s3gJgHm9-7Yg.gif","/img/help/2.0-astronaut-typing.png":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-astronaut-typing.Ob_pXA84QmY6tATF9JFKIw.png","/img/help/2.0-add-media.gif":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-add-media.LhrJcTFODoqjnPPuHNEInA.gif","/img/help/2.0-add-media-start.png":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-add-media-start.PTVdm36977cSfaYOpMNTNQ.png","/img/help/2.0-highlight-menu.gif":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-highlight-menu.vMoUc7pXOyYFMJX68LXicw.gif","/img/help/2.0-highlight-menu-start.png":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-highlight-menu-start.7vCytTKUZPOZvr_MCYADsA.png","/img/help/2.0-embed.gif":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-embed.2g5jIXYtWjsRFa9D-hBhMQ.gif","/img/help/2.0-embed-start.png":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-embed-start.LGy_FmixvcoEVIDKjg1jwA.png","/img/help/2.0-mention.gif":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-mention.H9pEv0eHAvkGUVqdrHxH5g.gif","/img/help/2.0-mention-start.png":"https://cdn-static-1.medium.com/_/fp/img/help/2.0-mention-start.ShYTOfy6w3VDU9PKFfOEyw.png","/img/help/highlight-tips-1.gif":"https://cdn-static-1.medium.com/_/fp/img/help/highlight-tips-1.dEp02HXMKtAeKxsV5MWqGg.gif","/img/help/highlight-tips-2.gif":"https://cdn-static-1.medium.com/_/fp/img/help/highlight-tips-2.SyXCciYXeNpx4-GUAuh0XQ.gif","/img/import/highlight-menu.png":"https://cdn-static-1.medium.com/_/fp/img/import/highlight-menu.kzoaVM8mJJ-Hu9m9uo3Omg.png","/img/import/image-highlight-menu.png":"https://cdn-static-1.medium.com/_/fp/img/import/image-highlight-menu.q43-H2dl0JvBS_5znQCW8A.png","/img/import/publish-metabar.png":"https://cdn-static-1.medium.com/_/fp/img/import/publish-metabar.YbEX1a2Pu0rAR_LuKeg8JA.png"},"facebookNamespace":"medium-com","authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"aadabda268e3bfaffe7b287709262fec","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","iconsSvgUrl":"/_/proxy-static/_/fp/icons/icons.e14UNvVDeCfX3LDLXV31aw.svg","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","iconsJsUrl":"https://cdn-static-1.medium.com/_/fp/js/icons.ya3M--pc6G6SUWyIzVkfFA.js","favIconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-new.TAS6uQ-Y7kcKgi0xjcYHXw.ico","cssFontUrls":["https://cdn-static-1.medium.com/_/fp/css/fonts-base.LqXl5T9RMAR39Ge23ku50w.css"]},"authBaseUrlRev":"moc.muidem//:sptth"}
// ]]></script><!--.--><!--.--><script>// <![CDATA[
window["obvInit"]({"value":{"id":"b63bfca0539","versionId":"d2383031d039","creatorId":"c1855caedf","creator":{"userId":"c1855caedf","name":"Deniz Ozger","username":"denizozger","createdAt":1375275368923,"lastPostCreatedAt":1403948836141,"imageId":"0*sd4q2ml2nYkrQGgb.jpeg","backgroundImageId":"","bio":"Web Engineer @Klarismo, Co-founder of @MostTalkedLive","twitterScreenName":"denizozger","socialStats":{"userId":"c1855caedf","usersFollowedCount":145,"usersFollowedByCount":143,"type":"SocialStats"},"social":{"userId":"lo_6f7b140a913d","targetUserId":"c1855caedf","type":"Social"},"facebookAccountId":"10152396792491181","type":"User"},"homeCollectionId":"","title":"Finding the right Node.js WebSocket implementation  ","detectedLanguage":"en","latestVersion":"d2383031d039","latestPublishedVersion":"d2383031d039","hasUnpublishedEdits":false,"latestRev":48,"createdAt":1387537188118,"updatedAt":1401915961044,"acceptedAt":0,"firstPublishedAt":1389268896120,"latestPublishedAt":1401915961044,"isRead":false,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"A journey with ws, Socket.IO, Engine.IO,  and Primus","bodyModel":{"paragraphs":[{"name":"title","type":2,"text":"Finding the right Node.js WebSocket implementation  "},{"name":"subtitle","type":13,"text":"A journey with ws, Socket.IO, Engine.IO,  and Primus"},{"name":"5d4c","type":1,"text":"For a current project at WhoScored, I needed to learn JavaScript, Node.js and WebSocket channel, after seven years of writing web applications with Java and Spring framework. We wanted an application that can send data to thousands of concurrent users, and Node.js appeared to be the right way of doing it with its event-driven, non-blocking I/O model that can scale up easily.","markups":[{"type":3,"start":25,"end":34,"href":"http://www.whoscored.com/","title":"","rel":""},{"type":3,"start":257,"end":305,"href":"http://www.toptal.com/nodejs/why-the-hell-would-i-use-node-js","title":"","rel":""}]},{"name":"f87d","type":1,"text":"Firstly, to learn JavaScript I started doing the tutorials in Code Academy and reading D. Crockford’s JavaScript: The Good Parts book. In parallel, I read J. R. Wilson’s Node.js the Right Way as well. It was a great read: by using some great modules like async, Q, ZMQ, Express, and methods like Promises and Generators, the book explains how to build scalable Node applications. It also covers sockets with Pub/Sub, Req/Res and Push/Pull patterns which shaped the WebSocket applications that I wrote.","markups":[{"type":3,"start":62,"end":74,"href":"http://www.codecademy.com/","title":"","rel":""},{"type":3,"start":102,"end":128,"href":"http://shop.oreilly.com/product/9780596517748.do","title":"","rel":""},{"type":3,"start":170,"end":191,"href":"http://pragprog.com/book/jwnode/node-js-the-right-way","title":"","rel":""}]},{"name":"203f","type":3,"text":"System structure","markups":[]},{"name":"9add","type":1,"text":"After some trials, errors, and brainstorming sessions, the final structure looks like this:","markups":[]},{"name":"83a2","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*NF1K_nSf9f18SMvJWzKsDQ.png","originalWidth":782,"originalHeight":492}},{"name":"b4b0","type":1,"text":"A client connects for a specific key/resource, let’s say “matchesfeed/8/matchcentre”. WebSocket server’s responsibility is to return some JSON data for this key. If it doesn’t have data for this key in its memory, it requests it from “Fetcher” via a Push socket implemented with ZMQ library over a TCP connection. Fetcher receives this request, and adds it to a queue of jobs. Worker processes (implemented with Node.js clusters) check this queue constantly, get a job, and make an HTTP call to an API that has the actual JSON data for this key. When response is received by a worker, it passes the data to master process, which sends it to WebSocket server, and puts the job back into queue. When WebSocket server receives data, it publishes to clients who are connected for that key. All applications are open source, and you can find web socket server here, fetcher here and the data provider here. Node.js version used in all applications are 0.10.","markups":[{"type":3,"start":279,"end":290,"href":"https://npmjs.org/package/zmq","title":"","rel":""},{"type":3,"start":412,"end":428,"href":"http://nodejs.org/api/cluster.html#cluster_cluster_fork_env","title":"","rel":""},{"type":3,"start":855,"end":859,"href":"https://github.com/denizozger/node-websocket","title":"","rel":""},{"type":3,"start":869,"end":873,"href":"https://github.com/denizozger/node-fetcher","title":"","rel":""},{"type":3,"start":896,"end":900,"href":"https://github.com/denizozger/node-dataprovider","title":"","rel":""}]},{"name":"2012","type":3,"text":"einaros / ws (v 0.4)","markups":[]},{"name":"ed06","type":1,"text":"Based on Heroku’s WebSocket demo, I began with einaros/ws implementation. It didn’t have as much as documentation that other frameworks had, but the development went smooth and I had something working in a short time.","markups":[{"type":3,"start":9,"end":32,"href":"https://github.com/heroku-examples/node-ws-test","title":"","rel":""},{"type":3,"start":47,"end":57,"href":"https://github.com/einaros/ws","title":"","rel":""}]},{"name":"be6c","type":4,"text":"Client beautifully connects via WebSockets","markups":[],"layout":1,"metadata":{"id":"1*dzS6cW-11XxS3sKwi5TH8A.png","originalWidth":765,"originalHeight":114}},{"name":"e477","type":1,"text":"Then I wrote a load test to see the performance. The test basically connects clients every half a second, all requesting the same data. Data is 165KB, and is sent every second. With 120 concurrent clients, the application allocates around 210MB of RAM, and data sent appears to be around 35 MB/second. The test machine is a 3.4 Ghz Intel i7 (8 processors) with 16GB of RAM, running OSX v10.9.","markups":[{"type":3,"start":13,"end":23,"href":"https://github.com/denizozger/node-websocket/blob/master/loadtest.js","title":"","rel":""},{"type":1,"start":144,"end":149},{"type":1,"start":163,"end":176},{"type":1,"start":182,"end":204}]},{"name":"40cf","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*ho2lGmulhn-ElpN-km49vw.png","originalWidth":366,"originalHeight":106}},{"name":"9088","type":1,"text":"I monitored the process with Strongloop’s agent, I find it pretty impressive.","markups":[{"type":3,"start":29,"end":47,"href":"https://npmjs.org/package/strong-agent","title":"","rel":""}]},{"name":"da66","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*LoD0vHyf--qeo_6_yT73tw.png","originalWidth":885,"originalHeight":1052}},{"name":"0960","type":1,"text":"At this point, the biggest drawback for me was it being a pure WebSocket implementation: if the client browser did not support WebSockets, it would not work. This made me try Socket.IO.","markups":[{"type":3,"start":175,"end":184,"href":"http://socket.io/","title":"","rel":""}]},{"name":"6bf6","type":3,"text":"Socket.IO (v. 0.9)","markups":[]},{"name":"91e4","type":1,"text":"Socket.IO seemed like the perfect solution, as it selects the most capable transport at runtime: it tries to connect to server via WebSockets first, if it doesn’t work, it downgrades by trying XHR-polling, if it doesn’t work, continues with flash sockets etc. Moreover, it would try to reconnect sockets if connection fails, and it supports rooms so that I could cluster connections based on what information they asked for, without any custom implementation. So I re-implemented the application by keeping everything the same but web socket framework.","markups":[{"type":1,"start":172,"end":182},{"type":1,"start":286,"end":295},{"type":1,"start":341,"end":346}]},{"name":"13ee","type":4,"text":"Client connects to Socket.IO server","markups":[],"layout":1,"metadata":{"id":"1*Tj6lWTMf_dWl993x9eGZhw.png","originalWidth":548,"originalHeight":198}},{"name":"6ba6","type":1,"text":"Indeed, when the server is down, Socket.IO tries to connect back with decreasing frequency.","markups":[]},{"name":"cd28","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*XKFMQnM3r07Zt4sia2OsWg.png","originalWidth":554,"originalHeight":246}},{"name":"7e24","type":1,"text":"And when the server is up, WebSocket connection is re-established:","markups":[]},{"name":"a8ac","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*1cDuBI9hO8rWvPphpwTWEA.png","originalWidth":550,"originalHeight":130}},{"name":"040e","type":1,"text":"Load test results are below, it is the same test I executed for ws/einaros implementation with the same data:","markups":[]},{"name":"b812","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*WAVyS8_ODWQL0r9uYG0UJw.png","originalWidth":894,"originalHeight":1055}},{"name":"ca1c","type":1,"text":"The data output looks like:","markups":[]},{"name":"6e90","type":4,"text":"In WS, average load was 35 MBs","markups":[],"layout":1,"metadata":{"id":"1*QU1hX4iLJrmtG__MCnaurA.png","originalWidth":367,"originalHeight":98}},{"name":"3919","type":13,"text":"Performance limit","markups":[]},{"name":"8f20","type":1,"text":"However, when I connect 140 clients, the memory usage starts to increment without the number of clients or the data size changing. Garbage Collector kicks in very frequently and gets more aggressive over time (sometimes a couple of times per second), eating up CPU time and desperately trying to free memory. Memory usage would reach ~1GB, then heartbeats would fail and clients would start to lose connection.","markups":[{"type":1,"start":24,"end":27},{"type":1,"start":28,"end":35}]},{"name":"cd9c","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*VSpub4TEOxu4RRnOtJ0uXg.png","originalWidth":783,"originalHeight":140}},{"name":"0ddb","type":4,"text":"Heap size stops increasing when connections start dropping, and keeps stable as Socket.IO clients tries to connect back. Also notice the very low event loop latency.","markups":[],"layout":1,"metadata":{"id":"1*pMFOD0TlXv0aiq2VbdnDOQ.png","originalWidth":881,"originalHeight":1043}},{"name":"68f5","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*uqQLvLCtsaADgJbWGxay_Q.png","originalWidth":366,"originalHeight":97}},{"name":"2c84","type":1,"text":"It’s time to debug!","markups":[]},{"name":"54b7","type":1,"text":"I used Mozilla’s memwatch module to detect memory leaks and take heap dumps to inspect the data. I found out that somehow 10MB Buffer objects would stack up constantly, you can find more details in my Stackoverflow Question. I couldn’t figure out why this would happen, but I think due to some cumulative CPU intensive operations, event loop response slows down and operations (sending messages) stack up in the queue. Being stuck, I decided to try out Sock.js.","markups":[{"type":3,"start":7,"end":32,"href":"https://hacks.mozilla.org/2012/11/tracking-down-memory-leaks-in-node-js-a-node-js-holiday-season/","title":"","rel":""},{"type":3,"start":198,"end":223,"href":"http://stackoverflow.com/questions/20566673/memory-leak-when-emitting-messages-with-socket-io-node-js-zmq","title":"","rel":""},{"type":3,"start":453,"end":458,"href":"https://github.com/sockjs/sockjs-client","title":"","rel":""}]},{"name":"034b","type":1,"text":"I must admit my Sock.js adventure didn’t last long after discovering that Sock.js does not support connection query strings. This would mean that I’d need to amend my code so that after clients connect, they’d need to send a seperate message to pass the parameter(s), and this was a bit turn off. Next, I decided to give Engine.IO a try.","markups":[{"type":3,"start":321,"end":330,"href":"https://github.com/LearnBoost/engine.io","title":"","rel":""}]},{"name":"8674","type":3,"text":"Engine.IO (v 0.7.12)","markups":[]},{"name":"2309","type":1,"text":"As far as I’ve seen, both Engine.IO and Socket.IO are mainly developed by Guillermo Rauch, and Engine.IO is a lower level library. Socket.IO v0.9 appears to be somewhat outdated and Engine.IO is the interim successor until Socket.IO v1.0 is released — which will use Engine.IO. One major difference is that Engine.IO always establishes a long-polling connection first, then tries to upgrade to better transports. This makes it resilient to firewalls and proxies, gives more predictable results and less frequent reconnecting. All other differences are very well listed on project’s readme. As you see, Engine.IO first started to connect via long-polling, then connected via WebSockets:","markups":[{"type":3,"start":74,"end":89,"href":"https://github.com/guille","title":"","rel":""},{"type":3,"start":572,"end":588,"href":"https://github.com/LearnBoost/engine.io#goals","title":"","rel":""},{"type":1,"start":383,"end":390}]},{"name":"0a2a","type":4,"text":"Notice the ‘transport’ parameter","markups":[],"layout":1,"metadata":{"id":"1*bpiyQzS3nXssOps_RXG9QQ.png","originalWidth":935,"originalHeight":283}},{"name":"d841","type":1,"text":"However its client library does not try to reconnect when connection terminates.","markups":[{"type":1,"start":27,"end":52}]},{"name":"bea6","type":1,"text":"Same load test with same values (160KB sent every second to 120 clients) looks like:","markups":[{"type":1,"start":33,"end":72}]},{"name":"1010","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*sAStZUaDk2kbVs8_7g3P2A.png","originalWidth":885,"originalHeight":1053}},{"name":"ccea","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*gRssPL3bttWdamv3oLd9SA.png","originalWidth":371,"originalHeight":97}},{"name":"760e","type":13,"text":"Performance limit","markups":[]},{"name":"f0a3","type":1,"text":"Let’s see what happens when we increase connection size. Engine.IO’s performance proved to be better for my application: I could load test with 230 concurrent connections, with (again) each one sent 165KB of data every second. Any number above 230 connections resulted in the application using massive amounts of data — up to 2GB (the same issue with Socket.IO implementation). Then connections would start dropping until 160 connections are remaining, and obviously this results in less resource usage. You can see this drop in the charts below. Remember in Engine.IO client implementation, clients don’t reconnect once they are disconnected.","markups":[{"type":1,"start":144,"end":170}]},{"name":"437c","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*VmsuyauLLwN_uDOmcop6Vw.png","originalWidth":891,"originalHeight":1057}},{"name":"5106","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*45gGF8eycV9Q1MwWBsBnBg.png","originalWidth":369,"originalHeight":103}},{"name":"cfcd","type":3,"text":"Primus (v 1.5.0)","markups":[]},{"name":"5c87","type":1,"text":"When I was about to end my research and development, I came across Primus. It is developed by Arnout Kazemier who is an active collabrator in some of the projects mentioned above. Primus actually lets you do what I have done all this time (changing WebSocket technologies for the business logic) dead easy: only with a single line of code. It has a similar syntax with all of the other frameworks, reconnects clients when connection terminates, and has lots of cool methods and structures — like rooms.","markups":[{"type":3,"start":67,"end":73,"href":"http://primus.io/","title":"","rel":""},{"type":3,"start":94,"end":109,"href":"https://github.com/3rd-Eden","title":"","rel":""}]},{"name":"a441","type":4,"text":"Primus connects","markups":[],"layout":1,"metadata":{"id":"1*0vgMgH7VO7tAtG5z_m_UoQ.png","originalWidth":716,"originalHeight":160}},{"name":"9972","type":1,"text":"Here are the test results for einaros/ws library with Primus (160KB sent every second to 120 clients):","markups":[{"type":1,"start":30,"end":40},{"type":1,"start":62,"end":101}]},{"name":"7182","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*UA6v1l5csnkmGJQ2B4x46A.png","originalWidth":879,"originalHeight":1044}},{"name":"d353","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*HvoLp6qUWXItPtXC3JYlwg.png","originalWidth":372,"originalHeight":101}},{"name":"0712","type":1,"text":"Compared to native implementation, it has a higher CPU usage and event loop latency, but a bit lower memory consumption. However, something unexpected happens after 10 minutes pass:","markups":[]},{"name":"12ad","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*Y7qKnDCQYAuDmFobs4xHUg.png","originalWidth":881,"originalHeight":1058}},{"name":"0fae","type":1,"text":"Event loop average drops to almost 0ms, but memory allocation starts to stack up, reaching GBs in minutes. This happened twice in two of my tries. I decided to leave this instead of digging deeper. (Please see Arnout’s comment about this issue on the right hand side)","markups":[{"type":2,"start":199,"end":266}]},{"name":"fc32","type":1,"text":"As Primus is a wrapper for socket libraries, I decided to use a native library just to have things on a lower level.","markups":[]},{"name":"8420","type":3,"text":"Looking back: Performance limit of einaros/ws","markups":[{"type":1,"start":0,"end":45}]},{"name":"e661","type":1,"text":"At this point, I wanted to look back and see at what rate einaros/ws implementation (which I ditched as it doesn’t support other connection types) would crash.","markups":[{"type":2,"start":58,"end":68}]},{"name":"52cc","type":1,"text":"By handling 410 concurrent connections, sending 165KB data to each every second, einaros/ws’s performance was far more superior than any other framework I tried. Compare it with Socket.IO’s max 140 connections and Engine.IO’s max 230 connections. einaros/ws would fail at 415 connections in the same way with other implementations: memory usage would stack up seemingly almost indefinitely (I waited until 8GB consumption before killing the process).","markups":[{"type":1,"start":12,"end":15},{"type":1,"start":194,"end":197},{"type":1,"start":230,"end":233},{"type":2,"start":81,"end":91},{"type":2,"start":247,"end":257}]},{"name":"8e7c","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*0V-fb_dFkoxsBAneeIG--w.png"}},{"name":"cb82","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*e0d2NB7dIRexSSagezudPw.png","originalWidth":369,"originalHeight":97}},{"name":"d157","type":3,"text":"Final decision on the framework","markups":[]},{"name":"2c7c","type":1,"text":"In summary, these test results showed that Engine.IO looks like the better choice for my application. It supports different connection types apart from WebSockets, and has a significantly better memory usage compared to others.","markups":[{"type":1,"start":43,"end":52}]},{"name":"9809","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*OlkZJXDjJ62aelM9Zlc_Dg.png","originalWidth":724,"originalHeight":133}},{"name":"264e","type":1,"text":"The difference in memory seems like a good trade of for losing the functionality of clients not reconnecting in a connection failure. At least, until Socket.IO 1.0 is released.","markups":[]},{"name":"7f37","type":3,"text":"Changing the flow based on limitations","markups":[]},{"name":"e173","type":1,"text":"The aim when starting this project was to have a system that can support thousands, even 10 thousand concurrent users. It seems, with 165KB of data sent every second, this won’t be possible. This made me decide to decrease the data size, and introduce a delta model, in which the application would send only the new JSON content instead of the whole object each time.","markups":[]},{"name":"ba37","type":3,"text":"Test 1: The impact of data size","markups":[]},{"name":"39db","type":1,"text":"I ran the a load test that uses 5KB of data, sent to 4000 users every second. 5KB of JSON makes around 200 lines of data with reasonable string length. I’ve also modified the test so that 10 new clients connect every second. The data throughput is equivalent to 20MB sent per second.","markups":[{"type":1,"start":32,"end":76}]},{"name":"8038","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*beMMwc93qJV0rX1qwhoYxQ.png","originalWidth":888,"originalHeight":1050}},{"name":"2d98","type":1,"text":"We will take these values as a base and see what happens when we keep throughput same and change some variables.","markups":[]},{"name":"4097","type":3,"text":"Test 2: The impact of concurrent connection size","markups":[]},{"name":"6fd5","type":1,"text":"In this test, 2000 users connected to the server, and received 10KBs of data every second. Again in this case, 20MB is sent every second.","markups":[{"type":1,"start":14,"end":24},{"type":1,"start":63,"end":68},{"type":1,"start":69,"end":89}]},{"name":"a6f4","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*mYnz2FhmPkLXTJWLDf9EoQ.png","originalWidth":891,"originalHeight":1060}},{"name":"1c68","type":1,"text":"Compare these results with test one. As you see, doubling the data size and decreasing the connection size by half ended up in 20% lower memory consumption, 35% lower CPU usage and 75% less event loop latency.","markups":[{"type":1,"start":49,"end":208}]},{"name":"6077","type":3,"text":"Test 3: The impact of data broadcasting frequency","markups":[]},{"name":"8ee9","type":1,"text":"In this test, 4000 users connected to the server, and received 10KB of data every 2 seconds. Again, this equals to 20MB sent every second.","markups":[{"type":1,"start":14,"end":18},{"type":1,"start":19,"end":24},{"type":1,"start":63,"end":91}]},{"name":"5828","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*Y91GPYv2Mg6FYiOqDq2TKQ.png","originalWidth":881,"originalHeight":1048}},{"name":"fb8c","type":1,"text":"Compare these results with the first test. It seems doubling data size and decreasing frequency of data sent by half results in 25% lower CPU usage, but more or less the same memory consumption and event loop latency.","markups":[{"type":1,"start":52,"end":217}]},{"name":"bd14","type":3,"text":"Conclusion","markups":[]},{"name":"ed97","type":1,"text":"We do not really have a direct control over how many connections the application will have if we have one server, thus it seems we can only play around with the size of data sent, and how frequent we send this data. These tests show that for a constant throughput, (at least) for Engine.IO, the number of connections have the biggest impact on performance, then comes reducing size of data, and lastly reducing frequency of data sent. Sending larger data in less frequency appears to yield better performance. It’s a double-sided sword though: increasing size of data packets was what made my applications crash as well.","markups":[{"type":1,"start":91,"end":112},{"type":1,"start":238,"end":290},{"type":1,"start":291,"end":355},{"type":1,"start":357,"end":433}]},{"name":"0463","type":1,"text":"So I think the best way of balancing it is to estimate the max number of concurrent users in the long run (at least a couple of years forward), finding the maximum data size that can be used with that number, and then decrease the frequency of sending data if possible — but as said this is not that critical. After this point, as connection number has the biggest impact on the performance, by using a load balancer, adding more application instances should increase the performance more than any other method.","markups":[{"type":1,"start":425,"end":451}]},{"name":"cc4e","type":1,"text":"Discuss this on Hacker News","markups":[{"type":3,"start":0,"end":27,"href":"https://news.ycombinator.com/item?id=7030100","title":"","rel":""}]},{"name":"4b8c","type":1,"text":"Acknowledgements: Benjamin Byholm for reviewing and commenting on this article with his insights on caching, multiple servers, and V8 memory usage. Arnout Kazemier for his helpful comments, Nico Kaiser for his feedback, Guillermo Rauch and David Halls for taking the time to read the draft.","markups":[{"type":3,"start":18,"end":33,"href":"https://github.com/kkoopa","title":"","rel":""},{"type":3,"start":148,"end":163,"href":"https://medium.com/@3rdEden","title":"Go to the profile of Arnout Kazemier","rel":""},{"type":3,"start":190,"end":201,"href":"https://github.com/nicokaiser","title":"","rel":""},{"type":3,"start":220,"end":235,"href":"https://github.com/guille","title":"","rel":""},{"type":3,"start":240,"end":251,"href":"https://github.com/davedoesdev","title":"","rel":""},{"type":1,"start":33,"end":34},{"type":2,"start":0,"end":290}]}],"sections":[{"startIndex":0,"backgroundImage":{"id":"1*RrKQrpOqLNPh6NJQ_InjXg.jpeg","originalWidth":4002,"originalHeight":2562,"filter":"grey"},"textLayout":2,"imageLayout":8},{"name":"dea3","startIndex":2},{"name":"ffb7","startIndex":82}]},"postDisplay":{"coverless":true}},"virtuals":{"createdAtRelative":"2 years ago","updatedAtRelative":"a year ago","acceptedAtRelative":"","createdAtEnglish":"December 20, 2013","updatedAtEnglish":"June 4, 2014","acceptedAtEnglish":"","firstPublishedAtEnglish":"January 9, 2014","latestPublishedAtEnglish":"June 4, 2014","allowNotes":true,"snippet":"A journey with ws, Socket.IO, Engine.IO,  and Primus","previewImage":{"imageId":"1*RrKQrpOqLNPh6NJQ_InjXg.jpeg","filter":"grey","backgroundSize":"","originalWidth":4002,"originalHeight":2562,"strategy":"resample","height":0,"width":0},"wordCount":1994,"imageCount":28,"readingTime":9.674528301886792,"subtitle":"A journey with ws, Socket.IO, Engine.IO,  and Primus","usersBySocialRecommends":[],"latestPublishedAtAbbreviated":"Jun 4, 2014","firstPublishedAtAbbreviated":"Jan 9, 2014","emailSnippet":"For a current project at WhoScored, I needed to learn JavaScript, Node.js and WebSocket channel, after seven years of writing web applications with Java and Spring framework. We wanted an application that can send data to thousands of concurrent users, and Node.js appeared to be the right way of doing it with its event-driven, non-blocking I/O model that can scale up easily. ¶\n\nFirstly, to learn JavaScript I started doing the tutorials in Code Academy and reading D.","recommends":166,"socialRecommends":[],"isBookmarked":false,"tags":[],"socialRecommendsCount":0,"responsesCreatedCount":4},"coverless":true,"slug":"finding-the-right-node-js-websocket-implementation","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":false,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"isViewed":false,"uniqueSlug":"","previewContent":{"bodyModel":{"paragraphs":[{"name":"1*RrKQrpOqLNPh6NJQ_InjXg.jpeg","type":4,"text":"","layout":10,"metadata":{"id":"1*RrKQrpOqLNPh6NJQ_InjXg.jpeg","originalWidth":4002,"originalHeight":2562,"filter":"grey"}},{"name":"title","type":2,"text":"Finding the right Node.js WebSocket implementation  ","alignment":1},{"name":"subtitle","type":13,"text":"A journey with ws, Socket.IO, Engine.IO,  and…","alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/@denizozger/finding-the-right-node-js-websocket-implementation-b63bfca0539","approvedHomeCollectionId":"","newsletterId":"","type":"Post","_isPopulated":true},"collaborators":[],"footerPromo":{"promoId":"read_next_sign_in_tnt","isDismissable":false,"imageId":"1*OlgaspZ00W78xQY-HE9Wsg.png"},"collectionUserRelations":[],"mode":null,"references":{"User":{"c1855caedf":{"userId":"c1855caedf","name":"Deniz Ozger","username":"denizozger","createdAt":1375275368923,"lastPostCreatedAt":1403948836141,"imageId":"0*sd4q2ml2nYkrQGgb.jpeg","backgroundImageId":"","bio":"Web Engineer @Klarismo, Co-founder of @MostTalkedLive","twitterScreenName":"denizozger","socialStats":{"userId":"c1855caedf","usersFollowedCount":145,"usersFollowedByCount":143,"type":"SocialStats"},"social":{"userId":"lo_6f7b140a913d","targetUserId":"c1855caedf","type":"Social"},"facebookAccountId":"10152396792491181","type":"User"}},"Social":{"c1855caedf":{"userId":"lo_6f7b140a913d","targetUserId":"c1855caedf","type":"Social"}},"SocialStats":{"c1855caedf":{"userId":"c1855caedf","usersFollowedCount":145,"usersFollowedByCount":143,"type":"SocialStats"}}}})
// ]]></script></body></html>
